<!DOCTYPE html>
<html>
    <head>
        <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.3/xlsx.full.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" style="width: 100%; height:auto">

        <style type="text/css">
            html, body{
                margin:0;
                height: 100%;
            }
            /*전체UI*/
            #containner{
                position:relative;
                display: -webkit-flex;
                display: flex;
                flex-direction: row;
                margin:auto;
                flex-wrap : wrap;
                width: 100%;
                text-align: center;
                -webkit-justify-content: center;
                justify-content: center;
                -webkit-align-items: center;
                align-items: center;
            }
            #phoneName{
                margin-top:20px;
                width:100%;
            }

            /*왼쪽 div*/
            #containner_left{
                width:450px;
                margin-top: 2px;
                margin-left: 20px;
                margin-right: 20px;
            }
            #color_pick{
                height:61px;
                margin-top: 20px;
                display: inline-block;
            }
            .color_pick_sub{
                float:left;
                margin:0px 15px;
            }
            .color_pick_sub img{
                transform:scale(1); 
                transition:transform 0.3s linear;
            }
            .color_pick_sub:hover img{
                transform: scale(1.3);
                -webkit-transform: scale(1.3);
                -moz-transform: scale(1.3);
                -ms-transform: scale(1.3);
                -o-transform: scale(1.3);
                
            }
            .color_text{
                margin-top: 5px;
            }

            /*가운데 div*/
            #containner_center{
                width:450px;
                margin-left: 20px;
                margin-right: 20px;
            }
            .center_item_head{
                height: 35px;
                margin-top:20px;
            }
            .center_item{
                height: 35px;
                margin-top:35px;
            }
            .center_sub{
                float: left;
            }
            .center_value{
            }

            /*오른쪽 div*/
            #containner_right{
                width:450px;
                margin-left: 20px;
                margin-right: 20px;
            }
            .right_item_head{
                height: 35px;
                margin-top:20px;
            }
            .right_item{
                height: 35px;
                margin-top:10px;
            }
            .right_sub{
                float: left;
            }
            .right_value{
                float: right;
            }
            .calc_ui{
                display:inline-block;
            }
                /* 오른쪽 최종계산 UI*/
                .calc_tap1{
                    width:90px;
                    float:left;
                }
                .calc_tap2{
                    width:45px;
                    float:left;
                }
                .calc_tap3{
                    width:90px;
                    float:left;
                }
                .calc_tap4{
                    width:45px;
                    float:left;
                }
                .calc_tap5{
                    width:90px;
                    float:left;
                }
            #total_sale_contract{
                display: none;
            }

        </style>
    </head>
        <body>
        <script type="text/javascript" language="javascript">
            // 핸드폰 출고가, 보조금 정보
            let PRICE_DATA;
            // 요금제 정보
            let PLAN_DATA;

            // 처음 시작시 엑셀을 불러와 json으로 변환해주는 스크립트
            function xml2json(){
                        /* set up XMLHttpRequest */
                var url = "price.xlsx";
                var oReq = new XMLHttpRequest();
                oReq.open("GET", url, true);
                oReq.responseType = "arraybuffer";

                oReq.onload = function(e) {
                    var arraybuffer = oReq.response;

                    /* convert data to binary string */
                    var data = new Uint8Array(arraybuffer);
                    var arr = new Array();
                    for (var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
                    var bstr = arr.join("");

                    /* Call XLSX */
                    var workbook = XLSX.read(bstr, {
                        type: "binary"
                    });

                    /* DO SOMETHING WITH workbook HERE */
                    workbook.SheetNames.forEach( function(data, idx){   //시트 여러개하려면 이곳에서 반복문
                        let sheetName = data;
                        //console.log(sheetName);
                        var worksheet = workbook.Sheets[data];
                        let datas = XLSX.utils.sheet_to_json(worksheet, {raw: true});
                        //console.log(datas);
                        if(sheetName=='요금제'){
                            PLAN_DATA = datas;
                        }
                        else if(sheetName == '가격표'){
                            PRICE_DATA = datas;
                        }

                    });
                }
                oReq.send();
            }
            xml2json();
            window.onload = function(){

                // 요금제와 가격이 들어있는 json
                var plans = new Object();
                // 기기의 출고가
                var phone_price;
                // 기기의 

                // 요금제 갯수!
                var plan_number = Object.keys(PRICE_DATA[1]).length-5;
                //요금제 이름과 비용을 json으로 만들어줌.
                for(i=0; i<plan_number; i++){
                    var key = PLAN_DATA[i]['이름'];
                    var val = PLAN_DATA[i]['요금'];
                    plans[key]=val;
                    // option을 추가해줌
                    $('#select_plan').append('<option value="'+i+'">'+key+'</option>');
                }
                // 출고가를 액셀에서 받아와넣어줌
                phone_price = PRICE_DATA[1]['출고가'];
                $('#phone_price_value').text(numberWithCommas( phone_price+"원"));

                //공시지원금 넣어줌, 액셀에서 불러옴. 가격마다 다름
                //현재 선택한 요금제를 불러옴
                var now_plan = $('#select_plan option:selected').val();
                //선택한 요금제의 보조금을 액셀에세 불러옴
                var spt_price = PRICE_DATA[1][now_plan+" "];
                $('#get_money_value').text(numberWithCommas( spt_price+"원"));

                //특별 할인가격 넣어줌 = 공시지원금 *0.15
                special_discount = spt_price * 0.15;
                $('#special_discount_value').text(numberWithCommas(special_discount+"원"));
                
                // 할부원금 = 출고가 - 보조금 - 특별할인가
                final_phone_price = phone_price - spt_price - special_discount;
                $('#last_price_phone_value').text(numberWithCommas(final_phone_price+"원"));
                
                //할부개월 현재 선택한거에서 불러옴
                month = $('input:radio[name="radio_month"]:checked').val() ;
                //요금제 = 현재 선택된 요금제
                $('#installment_month_value').text(month+"개월");

                //현재 선택한 요금제 plan_value
                var now_plan_char = PRICE_DATA[0][now_plan+" "]
                $('#plan_value').text(now_plan_char);

                //월 할부원금 = 할부원금 / 할부개월
                var month_price = parseInt(final_phone_price / month);
                $('#calc_result1').text(numberWithCommas(month_price)+"원");

                //통신요금 = 공시일경우 그대로, 아니면 할인요금 빼고
                var plan_price = plans[now_plan_char];
                $('#calc_result2').text(numberWithCommas(plan_price)+"원");

                //월 납부금액 = 월 할부원금 + 통신요금
                var pricep = month_price + plan_price;
                $('#calc_result3').text(numberWithCommas(pricep)+"원");


            }
            // 숫자에 콤바 붙여주는 정규식
            function numberWithCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
        </script>
        <script type="text/javascript" language="javascript">
            // 공시지원금 전용
            // 추가보조금
            var special_discount = 0;
            //공시지원금
            var discount = 0;

            // 선택약정 전용
            //매월할인
            var discount_month = 0;
            //24개월간 총 할인액
            var total_price_24month = 0;

            //공통
            //할부원금
            var final_phone_price = 0;
            //이자
            var interest = 0;
            //최종이자
            var final_interest = 0;
            //24개월
            var month24 = 0;
            //36개월
            var month36 = 0;
            //48개월
            var month48 = 0;
            ////////////////////////////////////////////////////////////
            let phone_price=0;
            let select_color=1;
            //현재 통신사 선택
            let radio_now_service ="sk";
            let radio_after_service  ="sk";
            //약정선택
            let radio_contract ="get_money";
            //할부개월
            let radio_month=24;
            //요금제 선택
            let select_plan =0;

            // 이미지 바꾸는 함수
            function onClick_changeColor(number){
                $("#main_image").attr("src", "./images/phone"+number+".png");
                $('input[name="radio_color"]:radio[value='+number+']').prop('checked',true);
                select_color = number;
            }
            // 이벤트 연결
            $(function(){
                //현재 통신사 선택 radio
                $('input[name=radio_now_service]').change(function(e){
                    radio_now_service=$(this).val();
                })

                //사용할 통신사 선택 radio
                $('input[name=radio_after_service]').change(function(e){
                    radio_after_service=$(this).val();

                })

                //약정선택 radio
                $('input[name=radio_contract]').change(function(e){
                    radio_contract=$(this).val();
                })

                // 할부 radio 골랐을 때
                $('input[name=radio_month]').change(function(e){
                    //지금 선택된 radio의 할부개월수
                    var month = $(this).val();
                    radio_month = month;
                    $('#installment_month_value').text(month+"개월");
                    
                })
                //요금제 select
                $('#select_plan').change(function(e){
                    select_plan=$(this).val();
                })

            });
        </script>
        <script type="text/javascript" language="javascript">
            // 각종 수식 계산
            function calc_price(){

            }
        </script>
        <div id="Parse_Area"gt;lt;/div>
        <!--전체 랩-->
        <div id = "containner">
            <!--상단 핸드폰 이름 -->
            <div id="phoneName" >
                갤럭시s9
            </div>
            <!--왼쪽 이미지-->
            <div id="containner_left">
                <!--핸드폰 이미지 나오는 div-->
                <div id = "main_image_div">
                    <img id="main_image" src="images/phone1.png" style="width:300px; height:300px;">
                </div>
                <!--색상 고르는 div 시작-->
                <div id="color_pick">
                    <div id="image_1" class="color_pick_sub" >
                        <div>
                            <img id="image1" src="images/phone1.png" style="width:40px; height:40px;" onclick="onClick_changeColor('1')" >
                        </div>
                        <div class="color_text">
                            블루
                        </div>
                    </div>
                    <div id="image_2" class="color_pick_sub">
                        <div>
                            <img id="image2"  src="images/phone2.png" style="width:40px; height:40px;"onclick="onClick_changeColor('2')">
                        </div>
                        <div class="color_text">
                            화이트
                        </div>
                    </div>
                    <div id="image_3" class="color_pick_sub">
                        <div>
                            <img id="image3"  src="images/phone3.png" style="width:40px; height:40px;"onclick="onClick_changeColor('3')">
                        </div>
                        <div class="color_text">
                            핑크
                        </div>
                    </div>
                </div>
            </div><!--왼쪽 끝-->
            <!--가운데 표-->
            <div id="containner_center">
                <div id="select_color" class="center_item_head">
                    <div class="center_sub">
                        색상
                    </div>
                    <div id="radio_color" class="center_value"  >
                        <label>
                            <input class="select_color"  type="radio" name="radio_color" value='1' onclick="onClick_changeColor(this.value)" checked>
                            블루
                        </label>
                        <label>
                            <input class="select_color" type="radio" name="radio_color" value='2' onclick="onClick_changeColor(this.value)">
                            화이트
                        </label>
                        <label>
                            <input class="select_color" type="radio" name="radio_color" value='3' onclick="onClick_changeColor(this.value)">
                            핑크
                        </label>
                    </div>
                </div>
                <div id="select_now_service" class="center_item">
                    <div class="center_sub">
                        사용중인 통신사
                    </div>
                    <div id="now_service" class="center_value"  >
                        <label>
                            <input class="radio_calc" type="radio" name="radio_now_service" value="sk" checked>
                            SK
                        </label>
                        <label>
                            <input class="radio_calc" type="radio" name="radio_now_service" value="kt" >
                            KT
                        </label>
                        <label>
                            <input class="radio_calc" type="radio" name="radio_now_service" value="lg" >
                            LG
                        </label>
                        <label>
                            <input class="radio_calc" type="radio" name="radio_now_service" value="etc" >
                            알뜰폰
                        </label>
                    </div>
                </div>
                <div id="select_after_service" class="center_item">
                    <div class="center_sub">
                        사용하실 통신사
                    </div>
                    <div id="after_service" class="center_value"  >
                        <label>
                        <input class="radio_calc" type="radio" name="radio_after_service" value="sk" checked>
                        SK
                    </label>
                        <!-- <label>
                        <input class="radio_calc" type="radio" name="radio_after_service" value="kt" >
                        KT
                    </label>
                        <label>
                        <input class="radio_calc" type="radio" name="radio_after_service" value="lg" >
                        LG
                    </label> -->
                    </div>
                </div>
                <div id="select_contract" class="center_item">
                    <div class="center_sub">
                        약정 선택
                    </div>
                    <div id="contract" class="center_value" >
                        <label>
                            <input class="radio_calc" type="radio" name="radio_contract" value="get_money" checked>
                            공시지원금(선택약정)
                        </label>
                        <label>
                            <input class="radio_calc" type="radio" name="radio_contract" value="discount_plan" >
                            요금제할인
                        </label>
                    </div>
                </div>
                <div id="select_info" class="center_item">
                    <div class="center_sub">
                        할부개월
                    </div>
                    <div id="info" class="center_value"  >
                        <label>
                            <input class="radio_calc" type="radio" name="radio_month" value="24" checked>
                            24개월
                        </label>
                        <label>
                            <input class="radio_calc" type="radio" name="radio_month" value="36" >
                            36개월
                        </label>
                        <label>
                            <input class="radio_calc" type="radio" name="radio_month" value="48" >
                            48개월
                        </label>
                    </div>
                </div>
                <div class="center_item">
                    <div class="center_sub">
                        요금제
                    </div>
                    <div id="plans" class="center_value"  >
                        <select id="select_plan" class="radio_calc">
                          </select>
                    </div>

                </div>
            </div><!--가운데 끝-->
            <!--오른쪽 표-->
            <div id="containner_right">
                <div id="phone_price" class="right_item_head">
                    <div class="right_sub">
                        출고가
                    </div>
                    <div id="phone_price_value" class="right_value">
                    </div>
                </div>
                <!--사용자가 입력 가능한 값-->
                <div id="special_discount" class="right_item">
                    <div class="right_sub">
                        특별할인
                    </div>
                    <div id="special_discount_value" class="right_value">
                    </div>
                </div>
                <!--공시지원금 버튼 선택시 보임, 요금제 할인 누를시 숨김-->
                <div id="get_money"class="right_item">
                    <div class="right_sub">
                        공시지원금
                    </div>
                    <div id="get_money_value" class="right_value">
                    </div>
                </div>
                <div id="last_price_phone" class="right_item">
                    <div class="right_sub">
                        할부원금
                    </div>
                    <div id="last_price_phone_value" class="right_value">
                    </div>
                </div>
                <!--요금제할인 버튼 선택시 보임, 공시지원금 누를시 숨김-->
                <div id="total_sale_contract" class="right_item">
                    <div class="right_sub">
                        요금제할인 총금액
                    </div>
                    <div id="total_sale_contract_value"  class="right_value">
                    </div>
                </div>
                <div id="installment_month" class="right_item">
                    <div class="right_sub">
                        할부개월
                    </div>
                    <div id="installment_month_value" class="right_value">
                    </div>
                </div>
                <div id="plan" class="right_item">
                    <div class="right_sub">
                        요금제
                    </div>
                    <div id="plan_value"  class="right_value">
                    </div>
                </div>
                <div id="month_price_ui" class="right_item">
                    <div class="calc_ui">
                        <div class="calc_tap1">
                            월 할부원금
                        </div>
                        <div class="calc_tap2">
                            +
                        </div>
                        <div class="calc_tap3">
                            통신요금
                        </div>
                        <div class="calc_tap4">
                            =
                        </div>
                        <div class="calc_tap5">
                            월 납부금액
                        </div>
                    </div>
                </div>
                <div id="month_price_calc" class="right_item">
                    <div class="calc_ui">
                        <div id="calc_result1" class="calc_tap1">
                            loading...
                        </div>
                        <div class="calc_tap2">
                            +
                        </div>
                        <div id="calc_result2" class="calc_tap3">
                            loading...
                        </div>
                        <div class="calc_tap4">
                            =
                        </div>
                        <div id="calc_result3" class="calc_tap5">
                            loading...
                        </div>
                    </div>
                </div>
                <div id="notice" class="right_item">
                    <div id="notice_value" class="">
                        (최종 월 납부액은 부가세 10% 와 분할상환 수수료 5.9% 포함됨)
                    </div>
                </div>
                <div id="button" class="right_item">
                    <div class="right_sub" style="background-color: aquamarine;">
                        신청하기 버튼
                    </div>
                </div>
            </div><!--오른쪽 끝-->
        </div>
    </body>
</html>